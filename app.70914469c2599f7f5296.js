(()=>{"use strict";(()=>{function e(){}function t(e){return e()}function n(){return Object.create(null)}function i(e){e.forEach(t)}function l(e){return"function"==typeof e}function o(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function s(e){return 0===Object.keys(e).length}function c(e,t,n,i){return e[1]&&i?function(e,t){for(const n in t)e[n]=t[n];return e}(n.ctx.slice(),e[1](i(t))):n.ctx}function u(e,t){e.appendChild(t)}function r(e,t,n){e.insertBefore(t,n||null)}function a(e){e.parentNode.removeChild(e)}function d(e){return document.createElement(e)}function b(e){return document.createTextNode(e)}function p(){return b(" ")}function f(){return b("")}function h(e,t,n,i){return e.addEventListener(t,n,i),()=>e.removeEventListener(t,n,i)}function g(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function m(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}function y(e,t){e.value=null==t?"":t}function k(e,t,n,i){e.style.setProperty(t,n,i?"important":"")}let $;function P(e){$=e}function v(){if(!$)throw new Error("Function called outside component initialization");return $}function I(e,t){const n=e.$$.callbacks[t.type];n&&n.slice().forEach((e=>e(t)))}new Set,new Set;const x=[],_=[],C=[],M=[],w=Promise.resolve();let E=!1;function U(e){C.push(e)}let B=!1;const A=new Set;function j(){if(!B){B=!0;do{for(let e=0;e<x.length;e+=1){const t=x[e];P(t),N(t.$$)}for(P(null),x.length=0;_.length;)_.pop()();for(let e=0;e<C.length;e+=1){const t=C[e];A.has(t)||(A.add(t),t())}C.length=0}while(x.length);for(;M.length;)M.pop()();E=!1,B=!1,A.clear()}}function N(e){if(null!==e.fragment){e.update(),i(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(U)}}const L=new Set;let O,R;function T(){O={r:0,c:[],p:O}}function S(){O.r||i(O.c),O=O.p}function H(e,t){e&&e.i&&(L.delete(e),e.i(t))}function z(e,t,n,i){if(e&&e.o){if(L.has(e))return;L.add(e),O.c.push((()=>{L.delete(e),i&&(n&&e.d(1),i())})),e.o(t)}}function K(e){e&&e.c()}function q(e,n,o,s){const{fragment:c,on_mount:u,on_destroy:r,after_update:a}=e.$$;c&&c.m(n,o),s||U((()=>{const n=u.map(t).filter(l);r?r.push(...n):i(n),e.$$.on_mount=[]})),a.forEach(U)}function J(e,t){const n=e.$$;null!==n.fragment&&(i(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function D(t,l,o,s,c,u,r=[-1]){const d=$;P(t);const b=t.$$={fragment:null,ctx:null,props:u,update:e,not_equal:c,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(d?d.$$.context:l.context||[]),callbacks:n(),dirty:r,skip_bound:!1};let p=!1;if(b.ctx=o?o(t,l.props||{},((e,n,...i)=>{const l=i.length?i[0]:n;return b.ctx&&c(b.ctx[e],b.ctx[e]=l)&&(!b.skip_bound&&b.bound[e]&&b.bound[e](l),p&&function(e,t){-1===e.$$.dirty[0]&&(x.push(e),E||(E=!0,w.then(j)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}(t,e)),n})):[],b.update(),p=!0,i(b.before_update),b.fragment=!!s&&s(b.ctx),l.target){if(l.hydrate){const e=(f=l.target,Array.from(f.childNodes));b.fragment&&b.fragment.l(e),e.forEach(a)}else b.fragment&&b.fragment.c();l.intro&&H(t.$$.fragment),q(t,l.target,l.anchor,l.customElement),j()}var f;P(d)}"undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global,new Set(["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"]),"function"==typeof HTMLElement&&(R=class extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){const{on_mount:e}=this.$$;this.$$.on_disconnect=e.map(t).filter(l);for(const e in this.$$.slotted)this.appendChild(this.$$.slotted[e])}attributeChangedCallback(e,t,n){this[e]=n}disconnectedCallback(){i(this.$$.on_disconnect)}$destroy(){J(this,1),this.$destroy=e}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){this.$$set&&!s(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}});class F{$destroy(){J(this,1),this.$destroy=e}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){this.$$set&&!s(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}function G(e){let t,n,l,o;const s=e[5].default,u=function(e,t,n,i){if(e){const i=c(e,t,n,null);return e[0](i)}}(s,e,e[4]);return{c(){t=d("button"),u&&u.c(),g(t,"class",e[1]),t.disabled=e[0]},m(i,s){r(i,t,s),u&&u.m(t,null),n=!0,l||(o=[h(t,"click",e[6]),h(t,"dblclick",e[7]),h(t,"focus",e[8])],l=!0)},p(e,[i]){u&&u.p&&16&i&&function(e,t,n,i,l,o,s){const u=function(e,t,n,i){if(e[2]&&i){const l=e[2](i(n));if(void 0===t.dirty)return l;if("object"==typeof l){const e=[],n=Math.max(t.dirty.length,l.length);for(let i=0;i<n;i+=1)e[i]=t.dirty[i]|l[i];return e}return t.dirty|l}return t.dirty}(t,i,l,null);if(u){const l=c(t,n,i,null);e.p(l,u)}}(u,s,e,e[4],i),(!n||2&i)&&g(t,"class",e[1]),(!n||1&i)&&(t.disabled=e[0])},i(e){n||(H(u,e),n=!0)},o(e){z(u,e),n=!1},d(e){e&&a(t),u&&u.d(e),l=!1,i(o)}}}function Q(e,t,n){let{$$slots:i={},$$scope:l}=t,{size:o}=t,{importance:s}=t,{disabled:c=!1}=t,u="";return e.$$set=e=>{"size"in e&&n(2,o=e.size),"importance"in e&&n(3,s=e.importance),"disabled"in e&&n(0,c=e.disabled),"$$scope"in e&&n(4,l=e.$$scope)},e.$$.update=()=>{if(12&e.$$.dirty){let e=[];o?e.push("size-"+o):e.push("size-regular"),s&&e.push("importance-"+s),n(1,u=["re-button",...e].join(" "))}},[c,u,o,s,l,i,function(t){I(e,t)},function(t){I(e,t)},function(t){I(e,t)}]}const V=class extends F{constructor(e){super(),D(this,e,Q,G,o,{size:2,importance:3,disabled:0})}};class W{constructor(e){this.kosyClient=window.parent,this.latestMessageNumber=0,this.kosyApp=e}startApp(){return this.initialInfoPromise=new Promise(((e,t)=>{window.addEventListener("message",(t=>{let n=t.data;switch(n.type){case"receive-initial-info":e(n.payload),this.latestMessageNumber=n.latestMessageNumber;break;case"client-has-joined":this.kosyApp.onClientHasJoined(n.clientInfo);break;case"client-has-left":this.kosyApp.onClientHasLeft(n.clientUuid);break;case"get-app-state":const t=this.kosyApp.onRequestState();this._sendMessageToKosy({type:"receive-app-state",state:t,clientUuids:n.clientUuids,latestMessageNumber:this.latestMessageNumber});break;case"set-app-state":this.kosyApp.onProvideState(n.state),this.latestMessageNumber=n.latestMessageNumber;break;case"receive-message-as-host":this._handleReceiveMessageAsHost(n);break;case"receive-message-as-client":this._handleReceiveMessageAsClient(n)}})),this._sendMessageToKosy({type:"ready-and-listening"})})),this.initialInfoPromise}stopApp(){this._sendMessageToKosy({type:"stop-app"})}relayMessage(e){this._sendMessageToKosy({type:"relay-message-to-host",message:e})}_sendMessageToKosy(e){this.kosyClient.postMessage(e,"*")}_handleReceiveMessageAsClientRecursive(e,t,n){this.latestMessageNumber===e.messageNumber-(t.currentClientUuid===e.sentByClientUuid?0:1)?(this.kosyApp.onReceiveMessageAsClient(e.message),this.latestMessageNumber=e.messageNumber):n<50&&this.latestMessageNumber<e.messageNumber&&setTimeout((()=>this._handleReceiveMessageAsClientRecursive(e,t,n+1)),100)}_handleReceiveMessageAsClient(e){this.initialInfoPromise.then((t=>{this._handleReceiveMessageAsClientRecursive(e,t,0)}))}_handleReceiveMessageAsHost(e){this.initialInfoPromise.then((t=>{const n=this.kosyApp.onReceiveMessageAsHost(e.message);n&&this._sendMessageToKosy({type:"relay-message-to-clients",sentByClientUuid:t.currentClientUuid,message:n,messageNumber:++this.latestMessageNumber})}))}}function X(e){let t,n,i,l,o,s,c=e[0].text+"",f=e[1]&&Z(e);return{c(){t=d("div"),n=d("p"),i=b(c),l=p(),f&&f.c(),k(t,"min-width","30px"),k(t,"min-height","14px")},m(c,a){r(c,t,a),u(t,n),u(n,i),u(t,l),f&&f.m(t,null),o||(s=h(t,"click",e[6]),o=!0)},p(e,n){1&n&&c!==(c=e[0].text+"")&&m(i,c),e[1]?f?f.p(e,n):(f=Z(e),f.c(),f.m(t,null)):f&&(f.d(1),f=null)},d(e){e&&a(t),f&&f.d(),o=!1,s()}}}function Y(e){let t,n,l,o;return{c(){t=d("div"),n=d("input"),g(n,"type","text")},m(i,s){r(i,t,s),u(t,n),e[7](n),y(n,e[0].text),l||(o=[h(n,"input",e[8]),h(n,"input",e[4]),h(n,"blur",e[5])],l=!0)},p(e,t){1&t&&n.value!==e[0].text&&y(n,e[0].text)},d(n){n&&a(t),e[7](null),l=!1,i(o)}}}function Z(e){let t,n,i;return{c(){t=d("p"),n=b("Locked by: "),i=b(e[1])},m(e,l){r(e,t,l),u(t,n),u(t,i)},p(e,t){2&t&&m(i,e[1])},d(e){e&&a(t)}}}function ee(t){let n;function i(e,t){return e[2]?X:Y}let l=i(t),o=l(t);return{c(){o.c(),n=f()},m(e,t){o.m(e,t),r(e,n,t)},p(e,[t]){l===(l=i(e))&&o?o.p(e,t):(o.d(1),o=l(e),o&&(o.c(),o.m(n.parentNode,n)))},i:e,o:e,d(e){o.d(e),e&&a(n)}}}function te(e,t,n){let i,l=function(){const e=v();return(t,n)=>{const i=e.$$.callbacks[t];if(i){const l=function(e,t){const n=document.createEvent("CustomEvent");return n.initCustomEvent(e,!1,!1,t),n}(t,n);i.slice().forEach((t=>{t.call(e,l)}))}}}(),{bulletPoint:o}=t,{isLockedBy:s}=t,{isLocked:c}=t;var u;return u=()=>{null==i||i.focus()},v().$$.on_mount.push(u),v().$$.after_update.push((()=>{null==i||i.focus()})),e.$$set=e=>{"bulletPoint"in e&&n(0,o=e.bulletPoint),"isLockedBy"in e&&n(1,s=e.isLockedBy),"isLocked"in e&&n(2,c=e.isLocked)},[o,s,c,i,e=>l("message",{type:"edit",text:e.target.value,bulletPointId:o.bulletPointId}),()=>l("message",{type:"unlock",bulletPointId:o.bulletPointId}),()=>l("message",{type:"lock",bulletPointId:o.bulletPointId}),function(e){_[e?"unshift":"push"]((()=>{i=e,n(3,i)}))},function(){o.text=this.value,n(0,o)}]}const ne=class extends F{constructor(e){super(),D(this,e,te,ee,o,{bulletPoint:0,isLockedBy:1,isLocked:2})}};function ie(e,t,n){const i=e.slice();return i[27]=t[n],i}function le(t){return{c:e,m:e,p:e,i:e,o:e,d:e}}function oe(e){let t,n,i,l,o,s,c=e[0].bulletPoints.filter(ae),b=[];for(let t=0;t<c.length;t+=1)b[t]=se(ie(e,c,t));const f=e=>z(b[e],1,1,(()=>{b[e]=null}));return o=new V({props:{importance:"primary",$$slots:{default:[ce]},$$scope:{ctx:e}}}),o.$on("click",e[7]),{c(){t=d("div"),n=d("ol");for(let e=0;e<b.length;e+=1)b[e].c();i=p(),l=d("div"),K(o.$$.fragment)},m(e,c){r(e,t,c),u(t,n);for(let e=0;e<b.length;e+=1)b[e].m(n,null);r(e,i,c),r(e,l,c),q(o,l,null),s=!0},p(e,t){if(39&t){let i;for(c=e[0].bulletPoints.filter(ae),i=0;i<c.length;i+=1){const l=ie(e,c,i);b[i]?(b[i].p(l,t),H(b[i],1)):(b[i]=se(l),b[i].c(),H(b[i],1),b[i].m(n,null))}for(T(),i=c.length;i<b.length;i+=1)f(i);S()}const i={};1073741824&t&&(i.$$scope={dirty:t,ctx:e}),o.$set(i)},i(e){if(!s){for(let e=0;e<c.length;e+=1)H(b[e]);H(o.$$.fragment,e),s=!0}},o(e){b=b.filter(Boolean);for(let e=0;e<b.length;e+=1)z(b[e]);z(o.$$.fragment,e),s=!1},d(e){e&&a(t),function(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}(b,e),e&&a(i),e&&a(l),J(o)}}}function se(e){let t,n,i,l;return n=new ne({props:{bulletPoint:e[27],isLocked:e[0].beingEdited[e[27].bulletPointId]!==e[1],isLockedBy:e[2][e[0].beingEdited[e[27].bulletPointId]]?.clientName}}),n.$on("message",e[6]),{c(){t=d("li"),K(n.$$.fragment),i=p()},m(e,o){r(e,t,o),q(n,t,null),u(t,i),l=!0},p(e,t){const i={};1&t&&(i.bulletPoint=e[27]),3&t&&(i.isLocked=e[0].beingEdited[e[27].bulletPointId]!==e[1]),5&t&&(i.isLockedBy=e[2][e[0].beingEdited[e[27].bulletPointId]]?.clientName),n.$set(i)},i(e){l||(H(n.$$.fragment,e),l=!0)},o(e){z(n.$$.fragment,e),l=!1},d(e){e&&a(t),J(n)}}}function ce(e){let t;return{c(){t=b("Add bullet point")},m(e,n){r(e,t,n)},d(e){e&&a(t)}}}function ue(t){let n;return{c(){n=d("p")},m(e,t){r(e,n,t)},p:e,i:e,o:e,d(e){e&&a(n)}}}function re(e){let t,n,i,l={ctx:e,current:null,token:null,hasCatch:!1,pending:ue,then:oe,catch:le,value:26,blocks:[,,,]};return function(e,t){const n=t.token={};function i(e,i,l,o){if(t.token!==n)return;t.resolved=o;let s=t.ctx;void 0!==l&&(s=s.slice(),s[l]=o);const c=e&&(t.current=e)(s);let u=!1;t.block&&(t.blocks?t.blocks.forEach(((e,n)=>{n!==i&&e&&(T(),z(e,1,1,(()=>{t.blocks[n]===e&&(t.blocks[n]=null)})),S())})):t.block.d(1),c.c(),H(c,1),c.m(t.mount(),t.anchor),u=!0),t.block=c,t.blocks&&(t.blocks[i]=c),u&&j()}if((l=e)&&"object"==typeof l&&"function"==typeof l.then){const n=v();if(e.then((e=>{P(n),i(t.then,1,t.value,e),P(null)}),(e=>{if(P(n),i(t.catch,2,t.error,e),P(null),!t.hasCatch)throw e})),t.current!==t.pending)return i(t.pending,0),!0}else{if(t.current!==t.then)return i(t.then,1,t.value,e),!0;t.resolved=e}var l}(n=e[4],l),{c(){t=f(),l.block.c()},m(e,n){r(e,t,n),l.block.m(e,l.anchor=n),l.mount=()=>t.parentNode,l.anchor=t,i=!0},p(t,[n]){{const i=(e=t).slice();i[26]=l.resolved,l.block.p(i,n)}},i(e){i||(H(l.block),i=!0)},o(e){for(let e=0;e<3;e+=1)z(l.blocks[e]);i=!1},d(e){e&&a(t),l.block.d(e),l.token=null,l=null}}}const ae=e=>!e.parentBulletPointId;function de(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(l,o){function s(e){try{u(i.next(e))}catch(e){o(e)}}function c(e){try{u(i.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?l(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,c)}u((i=i.apply(e,t||[])).next())}))};let l,o,s={bulletPoints:[],beingEdited:{}},c={},u=e=>{let t={bulletPointId:Date.now().toString(),parentBulletPointId:e,text:""};a.relayMessage({type:"add-bullet-point",bulletPoint:t,clientUuid:o})},r=e=>{a.relayMessage({type:"unlock-bullet-point",lockedBulletPointId:e,lockedByClientUuid:o})};const a=new W({onClientHasJoined:e=>(e=>{n(2,c[e.clientUuid]=e,c)})(e),onClientHasLeft:e=>(e=>{if(o===l){let t=s.bulletPoints.find((t=>s.beingEdited[t.bulletPointId]===e));t&&r(t.bulletPointId)}})(e),onReceiveMessageAsHost:e=>(e=>{switch(e.type){case"add-bullet-point":return{type:"bullet-point-added",bulletPoint:e.bulletPoint,clientUuid:e.clientUuid};case"edit-bullet-point":if(s.beingEdited[e.bulletPoint.bulletPointId]===e.clientUuid)return{type:"bullet-point-changed",bulletPoint:e.bulletPoint,clientUuid:e.clientUuid};break;case"remove-bullet-point":if(!s.beingEdited[e.bulletPointId]||s.beingEdited[e.bulletPointId]===e.clientUuid)return{type:"bullet-point-removed",clientUuid:e.clientUuid,bulletPointId:e.bulletPointId};break;case"lock-bullet-point":if(!s.beingEdited[e.lockedBulletPointId])return{type:"bullet-point-locked",lockedByClientUuid:e.lockedByClientUuid,lockedBulletPointId:e.lockedBulletPointId};break;case"unlock-bullet-point":if(s.beingEdited[e.lockedBulletPointId]===e.lockedByClientUuid)return{type:"bullet-point-unlocked",lockedByClientUuid:e.lockedByClientUuid,lockedBulletPointId:e.lockedBulletPointId}}})(e),onReceiveMessageAsClient:e=>{(e=>{i(void 0,void 0,void 0,(function*(){switch(console.log("Received a message from Kosy: ",e),e.type){case"bullet-point-added":i=e.bulletPoint,l=e.clientUuid,n(0,s={bulletPoints:[...s.bulletPoints,i],beingEdited:Object.assign(Object.assign({},s.beingEdited),{[i.bulletPointId]:l})});break;case"bullet-point-changed":e.clientUuid!==o&&((e,t)=>{let i=s.bulletPoints.map((t=>t.bulletPointId===e.bulletPointId?e:t));n(0,s=Object.assign(Object.assign({},s),{bulletPoints:i}))})(e.bulletPoint,e.clientUuid);break;case"bullet-point-removed":((e,t)=>{if(s.bulletPoints.find((t=>t.bulletPointId===e))){let t=s.bulletPoints.filter((t=>t.bulletPointId!==e));n(0,s=Object.assign(Object.assign({},s),{bulletPoints:t}))}})(e.bulletPointId,e.clientUuid);break;case"bullet-point-locked":((e,t)=>{n(0,s=Object.assign(Object.assign({},s),{beingEdited:Object.assign(Object.assign({},s.beingEdited),{[e]:t})}))})(e.lockedBulletPointId,e.lockedByClientUuid);break;case"bullet-point-unlocked":t=e.lockedBulletPointId,e.lockedByClientUuid,n(0,s=Object.assign(Object.assign({},s),{beingEdited:Object.assign(Object.assign({},s.beingEdited),{[t]:void 0})}))}var t,i,l}))})(e)},onRequestState:()=>s,onProvideState:e=>(e=>{n(0,s=null!=e?e:s)})(e)});let d=a.startApp().then((e=>{var t;l=e.initializerClientUuid,n(1,o=e.currentClientUuid),n(2,c=e.clients),n(0,s=null!==(t=e.currentAppState)&&void 0!==t?t:s)})).then((()=>!0)),b=e=>{switch(e.type){case"lock":t=e.bulletPointId,a.relayMessage({type:"lock-bullet-point",lockedBulletPointId:t,lockedByClientUuid:o});break;case"unlock":r(e.bulletPointId);break;case"edit":((e,t)=>{let n=s.bulletPoints.find((t=>t.bulletPointId===e));if(n){let e=Object.assign(Object.assign({},n),{text:t});a.relayMessage({type:"edit-bullet-point",clientUuid:o,bulletPoint:e})}})(e.bulletPointId,e.text);break;case"remove":(e=>{a.relayMessage({type:"remove-bullet-point",bulletPointId:e,clientUuid:o})})(e.bulletPointId);break;case"add-child":u(e.bulletPointId)}var t};return[s,o,c,u,d,b,e=>b(e.detail),()=>u()]}new class extends F{constructor(e){super(),D(this,e,de,re,o,{})}}({target:document.getElementById("container"),props:{}})})()})();